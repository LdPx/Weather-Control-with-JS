<!DOCTYPE html>
<html>

<head>
	<title>Weather</title>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
	<script>
		
		var weather = {
			// location
			lon:-1,
			lat:-1,
			cityName:"",
			//id
			country:"",
			
			// general
			wId:-1,
			wMain:"",
			wDescription:"",
			sunriseUnix:-1,
			sunriseDate: undefined,	//.getHours();	//.getMinutes();	//.getSeconds();
			sunsetUnix:-1,
			sunsetDate: undefined,	//.getHours();	//.getMinutes();	//.getSeconds();
			TimeOfData:-1,
			
			// weather
			temp:-99,
			pressure:-1,
			pressureSeaLevel:-1,
			pressureGroundLevel:-1,
			humidity:-1,
			windSpeed:-1,
			windDirectionDegree:-1,
			//windDirectionLetter
			thunder: false,
			drizzle: false,
			rain: false,
			snow: false,
			fog: false, // ???
			// clouds ???
			// hail ???
			
			cloudPercent:-1,
			rain3h:-1,
			snow3h:-1,
			
			toString : function() {
				return 'Stadt: ' + this.cityName + '<br>' +
					   'Beschreibung: ' + this.wDescription + ' (ID: ' + this.wId + ')' + '<br>' +
					   'Temperatur: ' + this.temp + '<br>' +
					   'Windgeschwindigkeit: ' + this.windSpeed + 'km/h, Richtung: ' + this.windDirectionDegree + '°<br>' +
					   'Wolken: ' + this.cloudPercent + '%<br>' +
					   'Niederschalg (letzte 3h): ' + this.rain3h + '<br>' +
					   'Schnee (letzte 3h): ' + this.snow3h + '<br>' +
					   'Luftfeuchtigkeit: ' + this.humidity;
			}
		};
		
		// TODO: make obj
		//		 init obj
		//		 rep. call?
		//		 setter func/but
		
		function gettingJSON(){
			//document.write("jquery loaded");
			$.getJSON('http://api.openweathermap.org/data/2.5/weather?lat=51.2&lon=6.47&units=metric&APPID=43a26c85c29d39f47dc194dda192eb3a',function(json){
				document.getElementById('JSONwrite').innerHTML += ('current temperature: ' + JSON.stringify(json.main.temp) + 'C°');
				//document.write(JSON.stringify(json));
				
				weather.lon = json.coord.lon;
				weather.lat = json.coord.lat;
				weather.cityName = json.name;
				weather.country = json.sys.country;
				
				weather.wId = json.weather.id;
				weather.wMain = json.weather.main;
				weather.wDescription = json.weather.description;
				weather.sunriseUnix = json.sys.sunrise;
				weather.sunriseDate = new Date(weather.sunriseUnix*1000);
				weather.sunsetUnix = json.sys.sunset;
				weather.sunsetDate = new Date(weather.sunsetUnix*1000);
				weather.TimeOfData = json.dt;
				
				weather.temp = json.main.temp;
				weather.pressure = json.main.pressure;
				weather.pressureSeaLevel = json.main.sea_level;
				weather.pressureGroundLevel = json.main.grnd_level;
				weather.humidity = json.main.humidity;
				weather.windSpeed = json.wind.speed;
				weather.windDirectionDegree = json.wind.deg;
				//weather.windDirectionLetter = json.
				weather.cloudPercent = json.clouds.all;
				if(json.hasOwnProperty('rain')){
					weather.rain3h = json.rain["3h"];	// Who is making this stuff up!?
				} else {
					weather.rain3h = 0;
				}
				if(json.hasOwnProperty('snow')){
					weather.snow3h = json.snow["3h"];
				} else {
					weather.snow3h = 0;
				}
				/* TODO - all codes
				if(json.weather.hasOwnProperty('id')){
					if (700 > json.weather.id >= 600
						weather.snow = true
				}
				*/
				document.getElementById('JSONwrite').innerHTML += '<br>' + weather.sunriseDate + '<br>';
				
				//document.write(weather);
			});
		}
		
		function testVarFromJSON(){
			document.getElementById('varTestWrite').innerHTML = weather.toString();
		}
		
	</script>
</head>

<body>
	<button id = 'getIt' onclick = 'gettingJSON()'>Get Weather-Data as JSON</button>
	<div id='JSONwrite'>   </div>
	<br><br>
	<button id = 'varTest' onclick = 'testVarFromJSON()'>v Test</button>
	<div id='varTestWrite'>   </div>
</body>

</html>
